{"ast":null,"code":"import { ApolloServer, gql } from 'apollo-server-micro';\nimport { graphql, GraphQLObjectType, GraphQLSchema } from 'graphql';\nimport { GraphQLDate, GraphQLTime, GraphQLDateTime } from 'graphql-iso-date';\n/**\n * Executes a shell command and return it as a Promise.\n * @param cmd {string}\n * @return {Promise<string>}\n */\n\nfunction execShellCommand(cmd) {\n  const {\n    exec\n  } = require('child_process');\n\n  return new Promise((resolve, reject) => {\n    exec(cmd, (error, stdout, stderr) => {\n      if (error) {\n        console.warn(error);\n      }\n\n      resolve(stdout ? stdout : stderr);\n    });\n  });\n}\n\nconst logger = console.log;\nconst typeDefs = gql`\n  scalar Date\n\n  type Task {\n    uuid: ID!\n    description: String\n    entry: Date\n    modified: Date\n    status: String\n    urgency: Float\n  }\n\n  type Query {\n    tasks(filter: String, context: String): [Task]\n  }\n\n  type Mutation {\n    modifyTask(uuid: ID, status: String): Task\n    addTask(description: String): String\n    syncTasks: String\n  }\n`;\nconst resolvers = {\n  Query: {\n    tasks: async (a, s, d, f) => {\n      let string = '-aaaaa ';\n\n      if (s.context) {\n        const contextFilters = `grep \"context.${s.context}\" /home/node/.taskrc | cut -d \\'=\\' -f 2`;\n        const context = await execShellCommand(contextFilters);\n        string = `${string} \\\\(${context.trim()}\\\\)`;\n      }\n\n      if (s.filter) {\n        string = `${string} ${s.filter}`;\n      }\n\n      const cmd = `/usr/bin/task ${string} export`;\n      logger(cmd);\n      const jsonString = await execShellCommand(cmd);\n      return JSON.parse(jsonString).sort((a, b) => {\n        return a.urgency - b.urgency;\n      });\n    }\n  },\n  Mutation: {\n    addTask: async (a, s, d, f) => {\n      await execShellCommand(`/usr/bin/task add ${s.description}`);\n      return 'ok';\n    },\n    syncTasks: async (a, s, d, f) => {\n      await execShellCommand('/usr/bin/task sync');\n      return 'ok';\n    },\n    modifyTask: async (a, s, d, f) => {\n      await execShellCommand(`/usr/bin/task ${s.uuid} modify status:${s.status}`);\n      const x = await execShellCommand(`/usr/bin/task rc.json.array=off ${s.uuid} export`);\n      return JSON.parse(x);\n    }\n  }\n};\nconst apolloServer = new ApolloServer({\n  typeDefs,\n  resolvers\n});\nconst handler = apolloServer.createHandler({\n  path: '/api/graphql'\n});\nexport const config = {\n  api: {\n    bodyParser: false\n  }\n};\nexport default handler;","map":{"version":3,"sources":["/home/node/app/pages/api/graphql.js"],"names":["ApolloServer","gql","graphql","GraphQLObjectType","GraphQLSchema","GraphQLDate","GraphQLTime","GraphQLDateTime","execShellCommand","cmd","exec","require","Promise","resolve","reject","error","stdout","stderr","console","warn","logger","log","typeDefs","resolvers","Query","tasks","a","s","d","f","string","context","contextFilters","trim","filter","jsonString","JSON","parse","sort","b","urgency","Mutation","addTask","description","syncTasks","modifyTask","uuid","status","x","apolloServer","handler","createHandler","path","config","api","bodyParser"],"mappings":"AAAA,SAASA,YAAT,EAAuBC,GAAvB,QAAkC,qBAAlC;AACA,SACEC,OADF,EAEEC,iBAFF,EAGEC,aAHF,QAIO,SAJP;AAMA,SACEC,WADF,EAEEC,WAFF,EAGEC,eAHF,QAIO,kBAJP;AAMA;;;;;;AAKA,SAASC,gBAAT,CAA0BC,GAA1B,EAA+B;AAC7B,QAAM;AAAEC,IAAAA;AAAF,MAAWC,OAAO,CAAC,eAAD,CAAxB;;AAEA,SAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCJ,IAAAA,IAAI,CAACD,GAAD,EAAM,CAACM,KAAD,EAAQC,MAAR,EAAgBC,MAAhB,KAA2B;AACnC,UAAIF,KAAJ,EAAW;AACTG,QAAAA,OAAO,CAACC,IAAR,CAAaJ,KAAb;AACD;;AACDF,MAAAA,OAAO,CAACG,MAAM,GAAEA,MAAF,GAAWC,MAAlB,CAAP;AACD,KALG,CAAJ;AAMD,GAPM,CAAP;AAQD;;AAED,MAAMG,MAAM,GAAGF,OAAO,CAACG,GAAvB;AAEA,MAAMC,QAAQ,GAAGrB,GAAI;;;;;;;;;;;;;;;;;;;;;CAArB;AAuBA,MAAMsB,SAAS,GAAG;AAChBC,EAAAA,KAAK,EAAE;AACLC,IAAAA,KAAK,EAAE,OAAOC,CAAP,EAASC,CAAT,EAAWC,CAAX,EAAaC,CAAb,KAAmB;AACxB,UAAIC,MAAM,GAAG,SAAb;;AAEA,UAAIH,CAAC,CAACI,OAAN,EAAe;AACb,cAAMC,cAAc,GAAG,iBAAgBL,CAAC,CAACI,OAAQ,0CAAjD;AACA,cAAMA,OAAO,GAAG,MAAMvB,gBAAgB,CAACwB,cAAD,CAAtC;AAEAF,QAAAA,MAAM,GAAI,GAAEA,MAAO,OAAMC,OAAO,CAACE,IAAR,EAAe,KAAxC;AACD;;AAED,UAAIN,CAAC,CAACO,MAAN,EAAc;AACZJ,QAAAA,MAAM,GAAI,GAAEA,MAAO,IAAGH,CAAC,CAACO,MAAO,EAA/B;AACD;;AAED,YAAMzB,GAAG,GAAI,iBAAgBqB,MAAO,SAApC;AACAV,MAAAA,MAAM,CAACX,GAAD,CAAN;AAEA,YAAM0B,UAAU,GAAG,MAAM3B,gBAAgB,CAACC,GAAD,CAAzC;AACA,aAAO2B,IAAI,CAACC,KAAL,CAAWF,UAAX,EAAuBG,IAAvB,CAA4B,CAACZ,CAAD,EAAIa,CAAJ,KAAS;AAC1C,eAAOb,CAAC,CAACc,OAAF,GAAYD,CAAC,CAACC,OAArB;AACD,OAFM,CAAP;AAGD;AAtBI,GADS;AA0BhBC,EAAAA,QAAQ,EAAE;AACRC,IAAAA,OAAO,EAAE,OAAOhB,CAAP,EAASC,CAAT,EAAWC,CAAX,EAAaC,CAAb,KAAmB;AAC1B,YAAMrB,gBAAgB,CAAE,qBAAoBmB,CAAC,CAACgB,WAAY,EAApC,CAAtB;AACA,aAAO,IAAP;AACD,KAJO;AAMRC,IAAAA,SAAS,EAAE,OAAOlB,CAAP,EAASC,CAAT,EAAWC,CAAX,EAAaC,CAAb,KAAmB;AAC5B,YAAMrB,gBAAgB,CAAC,oBAAD,CAAtB;AACA,aAAO,IAAP;AACD,KATO;AAWRqC,IAAAA,UAAU,EAAE,OAAOnB,CAAP,EAASC,CAAT,EAAWC,CAAX,EAAaC,CAAb,KAAmB;AAC7B,YAAMrB,gBAAgB,CAAE,iBAAgBmB,CAAC,CAACmB,IAAK,kBAAiBnB,CAAC,CAACoB,MAAO,EAAnD,CAAtB;AACA,YAAMC,CAAC,GAAG,MAAMxC,gBAAgB,CAAE,mCAAkCmB,CAAC,CAACmB,IAAK,SAA3C,CAAhC;AACA,aAAOV,IAAI,CAACC,KAAL,CAAWW,CAAX,CAAP;AACD;AAfO;AA1BM,CAAlB;AA6CA,MAAMC,YAAY,GAAG,IAAIjD,YAAJ,CAAiB;AACpCsB,EAAAA,QADoC;AAEpCC,EAAAA;AAFoC,CAAjB,CAArB;AAKA,MAAM2B,OAAO,GAAGD,YAAY,CAACE,aAAb,CAA2B;AAAEC,EAAAA,IAAI,EAAE;AAAR,CAA3B,CAAhB;AAEA,OAAO,MAAMC,MAAM,GAAG;AACpBC,EAAAA,GAAG,EAAE;AACHC,IAAAA,UAAU,EAAE;AADT;AADe,CAAf;AAMP,eAAeL,OAAf","sourcesContent":["import { ApolloServer, gql } from 'apollo-server-micro'\nimport {\n  graphql,\n  GraphQLObjectType,\n  GraphQLSchema,\n} from 'graphql' \n\nimport {\n  GraphQLDate,\n  GraphQLTime,\n  GraphQLDateTime\n} from 'graphql-iso-date'\n\n/**\n * Executes a shell command and return it as a Promise.\n * @param cmd {string}\n * @return {Promise<string>}\n */\nfunction execShellCommand(cmd) {\n  const { exec } = require('child_process')\n\n  return new Promise((resolve, reject) => {\n    exec(cmd, (error, stdout, stderr) => {\n      if (error) {\n        console.warn(error)\n      }\n      resolve(stdout? stdout : stderr)\n    })\n  })\n}\n\nconst logger = console.log\n\nconst typeDefs = gql`\n  scalar Date\n\n  type Task {\n    uuid: ID!\n    description: String\n    entry: Date\n    modified: Date\n    status: String\n    urgency: Float\n  }\n\n  type Query {\n    tasks(filter: String, context: String): [Task]\n  }\n\n  type Mutation {\n    modifyTask(uuid: ID, status: String): Task\n    addTask(description: String): String\n    syncTasks: String\n  }\n` \n\nconst resolvers = {\n  Query: {\n    tasks: async (a,s,d,f) => {\n      let string = '-aaaaa '\n\n      if (s.context) {\n        const contextFilters =`grep \"context.${s.context}\" /home/node/.taskrc | cut -d \\'=\\' -f 2`\n        const context = await execShellCommand(contextFilters)\n\n        string = `${string} \\\\(${context.trim()}\\\\)`\n      }\n\n      if (s.filter) {\n        string = `${string} ${s.filter}`\n      }\n\n      const cmd = `/usr/bin/task ${string} export`\n      logger(cmd)\n\n      const jsonString = await execShellCommand(cmd)\n      return JSON.parse(jsonString).sort((a, b) =>{\n        return a.urgency - b.urgency\n      })\n    },\n  },\n\n  Mutation: {\n    addTask: async (a,s,d,f) => {\n      await execShellCommand(`/usr/bin/task add ${s.description}`)\n      return 'ok'\n    },\n\n    syncTasks: async (a,s,d,f) => {\n      await execShellCommand('/usr/bin/task sync')\n      return 'ok'\n    },\n\n    modifyTask: async (a,s,d,f) => {\n      await execShellCommand(`/usr/bin/task ${s.uuid} modify status:${s.status}`)\n      const x = await execShellCommand(`/usr/bin/task rc.json.array=off ${s.uuid} export`)\n      return JSON.parse(x)\n    }\n  } \n}\n\nconst apolloServer = new ApolloServer({\n  typeDefs,\n  resolvers\n})\n\nconst handler = apolloServer.createHandler({ path: '/api/graphql' })\n\nexport const config = {\n  api: {\n    bodyParser: false\n  }\n}\n\nexport default handler\n"]},"metadata":{},"sourceType":"module"}